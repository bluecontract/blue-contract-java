---
name: Delegation Testing Contract
type:
  blueId: 6F9bjtAd85XgPGvzh7zcZp92tdR4mTcQcMUC8VuPYgZb
workflows:
  items:
  - name: change x
    steps:
      items:
      - name: must be Alice
        type:
          blueId: 5TrdtnYzrxenA6HLujs6z2Q5gLcS9heyrr3HpBNSbeFb
        code:
          type:
            blueId: F92yo19rCcbBoBSpUA5LRxpfDejJDAaP1PRxxbWAraVP
          value: |
            let expectedTimeline = contract("/messaging/participants/Alice/timeline");
            let timeline = event.timeline;

            if (timeline.blueId != expectedTimeline.blueId && event.message != 'go') {
              throw new RejectAndAwaitNextEventException('Not Alice!');
            }

            return { }
      - type:
          blueId: 6PsXX3HF74kESc6eg58z8kNwzqD64xQ3PjGPUppzcWg6
        changeset:
          items:
          - val:
              type:
                blueId: DHmxTkFbXePZHCHCYmQr2dSzcNLcryFVjXVHkdQrrZr8
              value: 1
            op:
              type:
                blueId: F92yo19rCcbBoBSpUA5LRxpfDejJDAaP1PRxxbWAraVP
              value: add
            path:
              type:
                blueId: F92yo19rCcbBoBSpUA5LRxpfDejJDAaP1PRxxbWAraVP
              value: /properties/x
    trigger:
      event:
        type:
          blueId: HWeoWDoYuMGdfzrCJoy58LeH9pFuPQXE9ioHvxVNBcPC
        message:
          type:
            blueId: F92yo19rCcbBoBSpUA5LRxpfDejJDAaP1PRxxbWAraVP
  - name: ask x
    steps:
      items:
      - type:
          blueId: 3uFwcdCx8Sdw43hGbBL3t9YGRocLbAewHzzxbrKAkUKF
        event:
          type:
            blueId: 7AvxNpdw5rH2bExYcLd9QQPTFJudYhgj2fCdMQGB5JJF
          event:
            type:
              blueId: HWeoWDoYuMGdfzrCJoy58LeH9pFuPQXE9ioHvxVNBcPC
            message:
              type:
                blueId: F92yo19rCcbBoBSpUA5LRxpfDejJDAaP1PRxxbWAraVP
              value: go
    trigger:
      event:
        type:
          blueId: HWeoWDoYuMGdfzrCJoy58LeH9pFuPQXE9ioHvxVNBcPC
        message:
          type:
            blueId: DHmxTkFbXePZHCHCYmQr2dSzcNLcryFVjXVHkdQrrZr8
properties:
  x:
    type:
      blueId: DHmxTkFbXePZHCHCYmQr2dSzcNLcryFVjXVHkdQrrZr8
    value: 0
messaging:
  participants:
    Bob:
      description: "Bob can't change x, but can call another workflow"
    Alice:
      description: Alice has privs to change x
